{% extends 'admin_panel/base.html' %}
{% load static %}

{% block title %}Create Event - EventAdmin{% endblock %}

{% block extra_css %}
<style>
    /* Glass Panel Utility */
    .glass-panel {
        background: rgba(30, 41, 59, 0.4);
        backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.05);
    }

    /* Form Inputs */
    .form-input {
        background-color: rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #f1f5f9;
        /* Slate-100 */
        transition: all 0.3s ease;
    }

    .form-input:focus {
        background-color: rgba(0, 0, 0, 0.4);
        border-color: #3b82f6;
        /* Blue-500 */
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        outline: none;
    }

    .form-input::placeholder {
        color: #64748b;
        /* Slate-500 */
    }

    /* Date Picker Dark Mode Fix */
    input[type="date"]::-webkit-calendar-picker-indicator,
    input[type="time"]::-webkit-calendar-picker-indicator {
        filter: invert(1);
        opacity: 0.6;
        cursor: pointer;
    }

    /* File Upload Zone */
    .upload-zone {
        background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='12' ry='12' stroke='%23475569' stroke-width='2' stroke-dasharray='8%2c 8' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        transition: all 0.3s ease;
    }

    .upload-zone:hover {
        background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='12' ry='12' stroke='%233B82F6' stroke-width='2' stroke-dasharray='8%2c 8' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        background-color: rgba(59, 130, 246, 0.05);
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto max-w-7xl animate-fade-in-up">

    <div class="mb-8">
        <h1 class="text-3xl font-bold text-white tracking-tight">Create New Event</h1>
        <p class="text-slate-400 mt-2">Fill in the details below to launch a new experience.</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <div class="lg:col-span-2">
            <form method="POST" enctype="multipart/form-data"
                class="glass-panel rounded-2xl p-6 md:p-8 relative overflow-hidden">
                {% csrf_token %}

                <div
                    class="absolute top-0 right-0 w-64 h-64 bg-blue-500/10 rounded-full blur-3xl pointer-events-none -translate-y-1/2 translate-x-1/3">
                </div>

                <div class="mb-8 relative z-10">
                    <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                        <span
                            class="w-8 h-8 rounded-lg bg-blue-500/20 text-blue-400 flex items-center justify-center mr-3 text-sm">
                            <i class="fas fa-info"></i>
                        </span>
                        Event Details
                    </h3>

                    <div class="space-y-5">
                        <div>
                            <label for="name"
                                class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Event
                                Name</label>
                            <input type="text" id="name" name="name" required
                                class="form-input w-full rounded-xl px-4 py-3"
                                placeholder="e.g. Summer Music Festival 2024" value="{{ form.name.value|default:'' }}">
                        </div>

                        <div>
                            <label for="description"
                                class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Description</label>
                            <textarea id="description" name="description" rows="4" required
                                class="form-input w-full rounded-xl px-4 py-3"
                                placeholder="Tell people what makes this event special...">{{ form.description.value|default:'' }}</textarea>
                        </div>
                    </div>
                </div>

                <div class="h-px bg-white/5 my-8"></div>

                <div class="mb-8 relative z-10">
                    <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                        <span
                            class="w-8 h-8 rounded-lg bg-purple-500/20 text-purple-400 flex items-center justify-center mr-3 text-sm">
                            <i class="fas fa-calendar-alt"></i>
                        </span>
                        Logistics
                    </h3>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div>
                            <label for="date"
                                class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Date</label>
                            <input type="date" id="date" name="date" required
                                class="form-input w-full rounded-xl px-4 py-3" value="{{ form.date.value|default:'' }}">
                        </div>
                        <div>
                            <label for="time"
                                class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Start
                                Time</label>
                            <input type="time" id="time" name="time" required
                                class="form-input w-full rounded-xl px-4 py-3" value="{{ form.time.value|default:'' }}">
                        </div>
                        <div class="md:col-span-2">
                            <label for="location"
                                class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Venue
                                Location</label>
                            <div class="relative">
                                <span class="absolute left-4 top-3.5 text-slate-500"><i
                                        class="fas fa-map-marker-alt"></i></span>
                                <input type="text" id="location" name="location" required
                                    class="form-input w-full rounded-xl pl-10 pr-4 py-3"
                                    placeholder="e.g. Grand City Hall, New York"
                                    value="{{ form.location.value|default:'' }}">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="h-px bg-white/5 my-8"></div>

                <div class="mb-8 relative z-10">
                    <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                        <span
                            class="w-8 h-8 rounded-lg bg-emerald-500/20 text-emerald-400 flex items-center justify-center mr-3 text-sm">
                            <i class="fas fa-ticket-alt"></i>
                        </span>
                        Capacity & Pricing
                    </h3>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
                        <div>
                            <label for="total_seats"
                                class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Total
                                Seats</label>
                            <input type="number" id="total_seats" name="total_seats" min="1" required
                                class="form-input w-full rounded-xl px-4 py-3" placeholder="100"
                                value="{{ form.total_seats.value|default:'' }}">
                        </div>
                        <div>
                            <label for="available_seats"
                                class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Available</label>
                            <input type="number" id="available_seats" name="available_seats" min="0"
                                class="form-input w-full rounded-xl px-4 py-3" placeholder="Auto"
                                value="{{ form.available_seats.value|default:'' }}">
                        </div>
                        <div>
                            <label for="ticket_price"
                                class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Price per
                                Ticket</label>
                            <div class="relative">
                                <span class="absolute left-4 top-3.5 text-slate-500 font-bold">₹</span>
                                <input type="number" id="ticket_price" name="ticket_price" step="0.01" min="0" required
                                    class="form-input w-full rounded-xl pl-8 pr-4 py-3" placeholder="0.00"
                                    value="{{ form.ticket_price.value|default:'' }}">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mb-8 relative z-10">
                    <label class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Event Cover
                        Image</label>

                    <div class="upload-zone rounded-xl p-8 text-center relative group cursor-pointer">
                        <input type="file" id="image" name="image" accept="image/*"
                            class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-20"
                            onchange="previewImage(event)">

                        <div id="upload-placeholder" class="transition-opacity duration-300">
                            <div
                                class="w-16 h-16 rounded-full bg-slate-800/80 flex items-center justify-center mx-auto mb-4 group-hover:bg-slate-700/80 transition-colors">
                                <i class="fas fa-cloud-upload-alt text-2xl text-blue-400"></i>
                            </div>
                            <p class="text-slate-300 font-medium">Click or drag image here</p>
                            <p class="text-xs text-slate-500 mt-2">Supports JPG, PNG (Max 5MB)</p>
                        </div>

                        <div id="image-preview-container" class="hidden relative z-10">
                            <img id="preview-img-tag"
                                class="max-h-64 mx-auto rounded-lg shadow-2xl border border-white/10" src="">
                            <div class="mt-4">
                                <span class="text-xs text-blue-400 hover:text-blue-300">Click to change image</span>
                            </div>
                        </div>
                    </div>
                </div>

                {% if form.errors %}
                <div class="mb-6 p-4 rounded-xl bg-red-500/10 border border-red-500/20">
                    <div class="flex items-center gap-2 mb-2 text-red-400">
                        <i class="fas fa-exclamation-circle"></i>
                        <h4 class="font-bold text-sm">Please fix the following errors:</h4>
                    </div>
                    <ul class="list-disc list-inside text-xs text-red-300/80 pl-2">
                        {% for field in form %}
                        {% for error in field.errors %}
                        <li>{{ field.label }}: {{ error }}</li>
                        {% endfor %}
                        {% endfor %}
                        {% for error in form.non_field_errors %}
                        <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                <div class="flex items-center justify-end gap-4 pt-4 relative z-10">
                    <a href="{% url 'admin_events_list' %}"
                        class="px-6 py-3 rounded-xl border border-slate-600 text-slate-300 hover:bg-white/5 hover:text-white transition-all font-medium text-sm">
                        Cancel
                    </a>
                    <button type="submit"
                        class="px-8 py-3 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold text-sm shadow-lg shadow-blue-500/20 hover:shadow-blue-500/40 hover:from-blue-500 hover:to-indigo-500 transition-all transform hover:-translate-y-0.5">
                        Create Event
                    </button>
                </div>

            </form>
        </div>

        <div class="lg:col-span-1 space-y-6">

            <div class="glass-panel rounded-2xl p-1 relative overflow-hidden">
                <div class="bg-slate-900/50 rounded-xl overflow-hidden p-4">
                    <h4 class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-4">Live Preview</h4>

                    <div class="bg-slate-800 rounded-xl overflow-hidden border border-white/5 shadow-xl">
                        <div class="h-40 w-full bg-slate-700 relative overflow-hidden group">
                            <img id="card-preview-img" src="https://via.placeholder.com/400x200?text=Event+Image"
                                class="w-full h-full object-cover opacity-60">
                            <div
                                class="absolute top-3 right-3 bg-black/50 backdrop-blur-md px-2 py-1 rounded text-xs font-bold text-white">
                                <i class="fas fa-star text-yellow-400 mr-1"></i> Featured
                            </div>
                        </div>

                        <div class="p-4">
                            <div class="flex justify-between items-start mb-2">
                                <h3 id="preview-name" class="text-white font-bold text-lg leading-tight truncate">Event
                                    Name</h3>
                                <div
                                    class="bg-emerald-500/10 text-emerald-400 text-xs font-bold px-2 py-1 rounded border border-emerald-500/20">
                                    <span id="preview-price">Free</span>
                                </div>
                            </div>

                            <div class="space-y-2 mb-4">
                                <div class="flex items-center text-xs text-slate-400">
                                    <i class="far fa-calendar text-blue-400 w-5"></i>
                                    <span id="preview-date">Date not set</span>
                                </div>
                                <div class="flex items-center text-xs text-slate-400">
                                    <i class="fas fa-map-marker-alt text-rose-400 w-5"></i>
                                    <span id="preview-location" class="truncate">Location not set</span>
                                </div>
                                <div class="flex items-center text-xs text-slate-400">
                                    <i class="fas fa-chair text-amber-400 w-5"></i>
                                    <span id="preview-seats">0 seats</span>
                                </div>
                            </div>

                            <button
                                class="w-full py-2 rounded-lg bg-blue-600/20 text-blue-400 text-xs font-bold border border-blue-600/30">
                                View Details
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="glass-panel rounded-2xl p-6">
                <h4 class="text-sm font-bold text-white mb-4 flex items-center">
                    <i class="fas fa-lightbulb text-yellow-400 mr-2"></i> Pro Tips
                </h4>
                <ul class="space-y-4">
                    <li class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 text-xs mt-1"></i>
                        <span class="text-xs text-slate-400 leading-relaxed">Use a high-quality <strong>16:9</strong>
                            image for best display on the dashboard.</span>
                    </li>
                    <li class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 text-xs mt-1"></i>
                        <span class="text-xs text-slate-400 leading-relaxed">Keep the <strong>Event Name</strong> short
                            and catchy (under 50 chars).</span>
                    </li>
                    <li class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 text-xs mt-1"></i>
                        <span class="text-xs text-slate-400 leading-relaxed">Set <strong>Available Seats</strong> lower
                            than Total Seats if you want to reserve a buffer.</span>
                    </li>
                </ul>
            </div>

        </div>
    </div>
</div>

<script>
    // --- Image Preview Logic ---
    function previewImage(event) {
        const input = event.target;
        const placeholder = document.getElementById('upload-placeholder');
        const previewContainer = document.getElementById('image-preview-container');
        const previewImgTag = document.getElementById('preview-img-tag');
        const cardPreviewImg = document.getElementById('card-preview-img');

        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function (e) {
                // Update Upload Zone
                placeholder.classList.add('hidden');
                previewContainer.classList.remove('hidden');
                previewImgTag.src = e.target.result;

                // Update Card Preview
                cardPreviewImg.src = e.target.result;
                cardPreviewImg.classList.remove('opacity-60');
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    // --- Live Text Preview Logic ---
    document.addEventListener('DOMContentLoaded', function () {

        // Input Map: ID -> Preview ID
        const inputs = {
            'name': 'preview-name',
            'location': 'preview-location'
        };

        // Generic Text Inputs
        Object.keys(inputs).forEach(id => {
            const input = document.getElementById(id);
            const target = document.getElementById(inputs[id]);
            if (input && target) {
                input.addEventListener('input', () => {
                    target.textContent = input.value || (id === 'name' ? 'Event Name' : 'Location not set');
                });
            }
        });

        // Date Handling
        const dateInput = document.getElementById('date');
        const timeInput = document.getElementById('time');
        const previewDate = document.getElementById('preview-date');

        function updateDateTime() {
            if (dateInput.value) {
                const d = new Date(dateInput.value);
                const dateStr = d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                const timeStr = timeInput.value ? ` • ${timeInput.value}` : '';
                previewDate.textContent = dateStr + timeStr;
            } else {
                previewDate.textContent = 'Date not set';
            }
        }
        if (dateInput) dateInput.addEventListener('change', updateDateTime);
        if (timeInput) timeInput.addEventListener('change', updateDateTime);

        // Seats Handling
        const totalSeats = document.getElementById('total_seats');
        const availSeats = document.getElementById('available_seats');
        const previewSeats = document.getElementById('preview-seats');

        function updateSeats() {
            // Auto-fill available seats if empty
            if (document.activeElement === totalSeats && !availSeats.value) {
                availSeats.value = totalSeats.value;
            }
            previewSeats.textContent = `${availSeats.value || 0} / ${totalSeats.value || 0} seats available`;
        }
        if (totalSeats) totalSeats.addEventListener('input', updateSeats);
        if (availSeats) availSeats.addEventListener('input', updateSeats);

        // Price Handling
        const priceInput = document.getElementById('ticket_price');
        const previewPrice = document.getElementById('preview-price');

        if (priceInput) {
            priceInput.addEventListener('input', () => {
                const val = parseFloat(priceInput.value);
                previewPrice.textContent = val > 0 ? `₹${val.toFixed(2)}` : 'Free';
            });
        }

        // --- Defaults ---
        // Set date min to today
        if (dateInput) {
            const today = new Date().toISOString().split('T')[0];
            dateInput.min = today;
        }
    });
</script>
{% endblock %}